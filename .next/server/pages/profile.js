"use strict";(()=>{var e={};e.id=277,e.ids=[277,660],e.modules={3190:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>g,default:()=>m,getServerSideProps:()=>h,getStaticPaths:()=>x,getStaticProps:()=>p,reportWebVitals:()=>j,routeModule:()=>w,unstable_getServerProps:()=>S,unstable_getServerSideProps:()=>v,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>f});var a=s(7093),n=s(5244),o=s(1323),i=s(2899),l=s.n(i),c=s(6814),d=s(5224),u=e([c,d]);[c,d]=u.then?(await u)():u;let m=(0,o.l)(d,"default"),p=(0,o.l)(d,"getStaticProps"),x=(0,o.l)(d,"getStaticPaths"),h=(0,o.l)(d,"getServerSideProps"),g=(0,o.l)(d,"config"),j=(0,o.l)(d,"reportWebVitals"),f=(0,o.l)(d,"unstable_getStaticProps"),y=(0,o.l)(d,"unstable_getStaticPaths"),b=(0,o.l)(d,"unstable_getStaticParams"),S=(0,o.l)(d,"unstable_getServerProps"),v=(0,o.l)(d,"unstable_getServerSideProps"),w=new a.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/profile",pathname:"/profile",bundlePath:"",filename:""},components:{App:c.default,Document:l()},userland:d});r()}catch(e){r(e)}})},5224:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>g,getServerSideProps:()=>j});var a=s(997),n=s(2210),o=s(1664),i=s.n(o),l=s(1649),c=s(1163),d=s(6134),u=s(7091),m=s(4328),p=s(6689),x=s(3481),h=e([n,d,u,m,x]);function g({hostedEvents:e,joinedEvents:t}){let{data:s,status:r}=(0,l.useSession)();(0,c.useRouter)();let o=(0,n.useToast)(),[m,x]=(0,p.useState)(""),[h,g]=(0,p.useState)(""),[j,f]=(0,p.useState)(""),[y,b]=(0,p.useState)(""),[S,v]=(0,p.useState)(""),[w,N]=(0,p.useState)(!1),[C,P]=(0,p.useState)(!1),[I,F]=(0,p.useState)(!1),[T,E]=(0,p.useState)(""),z=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),B=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),L=async()=>{if(window.confirm("Are you sure you want to delete your account? This action cannot be undone.")){F(!0);try{let e=await fetch("/api/user/delete-account",{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.json();throw Error(t.message||"Failed to delete account")}(0,l.signOut)({callbackUrl:"/"}),o({title:"Account deleted",description:"Your account has been successfully deleted",status:"success",duration:3e3,isClosable:!0})}catch(e){o({title:"Deletion failed",description:e.message||"Failed to delete account",status:"error",duration:5e3,isClosable:!0})}finally{F(!1)}}},k=async e=>{if(e.preventDefault(),P(!0),E(""),y){if(y.length<8){E("Password must be at least 8 characters"),P(!1);return}if(y!==S){E("Passwords do not match"),P(!1);return}}try{let e=await fetch("/api/user/update-profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:m,lastName:h,email:j,password:y||void 0})}),t=await e.json();if(!e.ok)throw Error(t.message||"Failed to update profile");b(""),v(""),N(!1),o({title:"Profile updated",description:"Your profile has been successfully updated",status:"success",duration:3e3,isClosable:!0})}catch(e){o({title:"Update failed",description:e.message||"Failed to update profile",status:"error",duration:5e3,isClosable:!0})}finally{P(!1)}};return s?(0,a.jsxs)(n.Container,{maxW:"container.xl",py:8,children:[(0,a.jsxs)(n.Box,{className:"bg-white rounded-lg shadow-md p-8 mb-8",children:[(0,a.jsxs)(n.Flex,{justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:4,mb:6,children:[a.jsx(n.Heading,{as:"h1",size:"xl",className:"text-primary-700",children:"My Profile"}),!w&&a.jsx(n.Button,{leftIcon:a.jsx(d.EditIcon,{}),colorScheme:"secondary",onClick:()=>N(!0),children:"Edit Profile"})]}),w?(0,a.jsxs)(n.Box,{as:"form",onSubmit:k,children:[(0,a.jsxs)(n.SimpleGrid,{columns:{base:1,md:2},spacing:6,children:[(0,a.jsxs)(n.FormControl,{isRequired:!0,children:[a.jsx(n.FormLabel,{className:"text-gray-700",children:"First Name"}),a.jsx(n.Input,{value:m,onChange:e=>x(e.target.value),className:"form-input"})]}),(0,a.jsxs)(n.FormControl,{isRequired:!0,children:[a.jsx(n.FormLabel,{className:"text-gray-700",children:"Last Name"}),a.jsx(n.Input,{value:h,onChange:e=>g(e.target.value),className:"form-input"})]}),(0,a.jsxs)(n.FormControl,{isRequired:!0,gridColumn:{md:"span 2"},children:[a.jsx(n.FormLabel,{className:"text-gray-700",children:"Email"}),a.jsx(n.Input,{type:"email",value:j,onChange:e=>f(e.target.value),className:"form-input"})]}),a.jsx(n.Divider,{my:6,gridColumn:{md:"span 2"}}),a.jsx(n.Heading,{as:"h3",size:"md",gridColumn:{md:"span 2"},mb:4,children:"Change Password (Optional)"}),(0,a.jsxs)(n.FormControl,{gridColumn:{md:"span 2"},children:[a.jsx(n.FormLabel,{className:"text-gray-700",children:"New Password"}),a.jsx(n.Input,{type:"password",value:y,onChange:e=>b(e.target.value),className:"form-input",placeholder:"Leave blank to keep current password"})]}),(0,a.jsxs)(n.FormControl,{gridColumn:{md:"span 2"},isInvalid:!!T,children:[a.jsx(n.FormLabel,{className:"text-gray-700",children:"Confirm New Password"}),a.jsx(n.Input,{type:"password",value:S,onChange:e=>v(e.target.value),className:"form-input",placeholder:"Confirm new password"}),T&&a.jsx(n.Text,{color:"red.500",fontSize:"sm",mt:1,children:T})]})]}),(0,a.jsxs)(n.Flex,{mt:6,gap:4,justifyContent:"space-between",children:[a.jsx(n.Button,{variant:"outline",colorScheme:"red",onClick:L,isLoading:I,leftIcon:a.jsx(d.InfoIcon,{}),children:"Delete Account"}),(0,a.jsxs)(n.Flex,{gap:4,children:[a.jsx(n.Button,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),a.jsx(n.Button,{type:"submit",colorScheme:"primary",isLoading:C,children:"Save Changes"})]})]})]}):(0,a.jsxs)(n.Flex,{alignItems:"center",gap:6,flexWrap:{base:"wrap",md:"nowrap"},children:[a.jsx(n.Avatar,{size:"xl",name:`${m} ${h}`,src:"",bg:"primary.500"}),(0,a.jsxs)(n.Box,{children:[(0,a.jsxs)(n.Heading,{size:"lg",mb:2,children:[m," ",h]}),a.jsx(n.Text,{className:"text-gray-600",children:j}),(0,a.jsxs)(n.Text,{className:"text-gray-500 mt-2",children:["Member since ",new Date().getFullYear()]})]})]})]}),(0,a.jsxs)(n.Tabs,{colorScheme:"primary",className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)(n.TabList,{children:[(0,a.jsxs)(n.Tab,{children:["Hosted Events (",e.length,")"]}),(0,a.jsxs)(n.Tab,{children:["Joined Events (",t.length,")"]})]}),(0,a.jsxs)(n.TabPanels,{children:[a.jsx(n.TabPanel,{children:0===e.length?(0,a.jsxs)(n.Box,{textAlign:"center",py:10,children:[a.jsx(n.Text,{fontSize:"lg",mb:4,className:"text-gray-600",children:"You haven't hosted any events yet"}),a.jsx(i(),{href:"/events/create",passHref:!0,children:a.jsx(n.Button,{as:"a",colorScheme:"primary",size:"lg",children:"Create Your First Event"})})]}):a.jsx(n.SimpleGrid,{columns:{base:1,md:2,lg:3},spacing:6,mt:4,children:e.map(e=>a.jsx(u.Z,{id:e.id,title:e.title,description:e.description,date:e.date,game:e.game,address:e.address,author:e.author},e.id))})}),a.jsx(n.TabPanel,{children:0===t.length?(0,a.jsxs)(n.Box,{textAlign:"center",py:10,children:[a.jsx(n.Text,{fontSize:"lg",mb:4,className:"text-gray-600",children:"You haven't joined any events yet"}),a.jsx(i(),{href:"/events",passHref:!0,children:a.jsx(n.Button,{as:"a",colorScheme:"primary",size:"lg",children:"Browse Events"})})]}):a.jsx(n.SimpleGrid,{columns:{base:1,md:2,lg:3},spacing:6,mt:4,children:t.map(e=>a.jsx(i(),{href:`/events/${e.id}`,children:(0,a.jsxs)(n.Box,{className:"card hover:border-secondary-300 cursor-pointer",_hover:{transform:"translateY(-4px)",boxShadow:"md"},transition:"all 0.3s ease",children:[(0,a.jsxs)(n.Flex,{justifyContent:"space-between",alignItems:"flex-start",mb:3,children:[a.jsx(n.Heading,{size:"md",className:"text-primary-700 line-clamp-2",children:e.title}),a.jsx(n.Badge,{colorScheme:"purple",p:1,borderRadius:"md",children:e.game})]}),a.jsx(n.Text,{className:"text-gray-600 mb-4 line-clamp-3",title:e.description,children:e.description}),a.jsx(n.Divider,{my:4}),(0,a.jsxs)(n.Flex,{justifyContent:"space-between",alignItems:"center",wrap:"wrap",gap:2,children:[(0,a.jsxs)(n.Flex,{alignItems:"center",children:[a.jsx(d.CalendarIcon,{className:"text-secondary-500 mr-2"}),a.jsx(n.Text,{fontSize:"sm",className:"text-gray-700",children:z(e.date)})]}),(0,a.jsxs)(n.Flex,{alignItems:"center",children:[a.jsx(d.TimeIcon,{className:"text-secondary-500 mr-2"}),a.jsx(n.Text,{fontSize:"sm",className:"text-gray-700",children:B(e.date)})]})]}),(0,a.jsxs)(n.Flex,{alignItems:"center",mt:3,children:[a.jsx(d.InfoIcon,{className:"text-primary-500 mr-2"}),a.jsx(n.Text,{fontSize:"sm",className:"text-gray-700 truncate",title:e.address||"",children:e.address||"Location not specified"})]}),(0,a.jsxs)(n.Text,{fontSize:"sm",className:"text-gray-500 mt-3",children:["Hosted by: ",e.author]})]})},e.id))})})]})]})]}):null}[n,d,u,m,x]=h.then?(await h)():h;let j=async e=>{let t=await (0,l.getSession)(e);if(console.log("Session in getServerSideProps:",JSON.stringify(t,null,2)),!t)return{redirect:{destination:"/auth/signin",permanent:!1}};try{let e=await (0,m.IP)(),s=t.user?.email;console.log("User email from session:",s);let r=await x.db.selectFrom("accounts").select(["id","username"]).where("username","=",s||"").execute();if(console.log("Accounts found:",r),!r||0===r.length)throw console.error("User account not found"),Error("User account not found");let a=r[0].id;console.log("User ID from database:",a),console.log("All events:",e.map(e=>({id:e.id,title:e.title,hostId:e.hostId})));let n=await x.db.selectFrom("accounts").selectAll().execute();console.log("All accounts:",n);let o=n.find(e=>e.username===s);console.log("User account found:",o);let i=[],l=[];return o?(i=e.filter(e=>(console.log(`Comparing event hostId ${e.hostId} with account ID ${o.id}`),Number(e.hostId)===Number(o.id))),l=e.filter(e=>Number(e.hostId)!==Number(o.id))):(console.log("No user account found, showing all events as joined events"),l=e),console.log("Hosted events:",i.length),console.log("Joined events:",l.length),{props:{hostedEvents:JSON.parse(JSON.stringify(i)),joinedEvents:JSON.parse(JSON.stringify(l))}}}catch(e){return console.error("Error fetching user events:",e),{props:{hostedEvents:[],joinedEvents:[]}}}};r()}catch(e){r(e)}})},1649:e=>{e.exports=require("next-auth/react")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},6134:e=>{e.exports=import("@chakra-ui/icons")},2210:e=>{e.exports=import("@chakra-ui/react")},366:e=>{e.exports=import("kysely")},8678:e=>{e.exports=import("pg")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[117,899,664,342,904],()=>s(3190));module.exports=r})();